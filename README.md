# Discord Bot для кадрового управления

Этот бот создан для помощи в кадровой работе. Он позволяет настраивать специальные каналы для рапортов на увольнение, кадрового аудита и чёрного списка.

## Структура проекта

```
├── app.py                  # Основной файл бота
├── requirements.txt        # Зависимости проекта
├── setup.bat               # Скрипт для настройки (Windows)
├── cogs/                   # Модули команд (расширения)
│   ├── __init__.py
│   └── channel_manager.py  # Управление каналами
├── utils/                  # Утилиты и вспомогательные функции
│   ├── __init__.py
│   └── config_manager.py   # Работа с конфигурацией 
├── forms/                  # Формы и UI элементы
│   ├── __init__.py
│   ├── dismissal_form.py   # Форма для рапорта на увольнение
│   ├── audit_form.py       # Форма для кадрового аудита
│   └── blacklist_form.py   # Форма для чёрного списка
└── data/                   # Данные и конфигурация
    └── config.json         # Файл конфигурации
```

## Функциональность

### Система увольнений
- Кнопка для отправки рапорта на увольнение
- Форма с полями: Имя, Статик (формат 123-456), Причина
- Красивое оформление сообщений с embed
- Статус рассмотрения

### Кадровый аудит
- Система для ведения учёта персонала
- Форма с полями: Имя, Должность, Статик, Отдел, Примечания
- Автоматическая регистрация записей

### Чёрный список
- Система для ведения чёрного списка нарушителей
- Форма с полями: Имя, Статик, Причина, Доказательства
- Строгий контроль и валидация

## Настройка

### Требования
- Python 3.8 или выше
- Discord.py 2.0 или выше

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Настройка токена бота

Для работы бота необходимо создать в Discord Developer Portal приложение и бота, а затем указать токен одним из следующих способов:

1. Через переменную окружения:
```powershell
$env:DISCORD_TOKEN = "ваш_токен_бота"
```

2. Через файл `.env` в корне проекта:
```
DISCORD_TOKEN=ваш_токен_бота
```

3. Через файл `token.txt` в корне проекта (просто текстовый файл с токеном)

### Включение привилегированных интентов

⚠️ **ВАЖНО**: Для работы бота необходимо включить привилегированные интенты в Discord Developer Portal:

1. Перейдите на https://discord.com/developers/applications/
2. Выберите вашего бота
3. Перейдите во вкладку 'Bot'
4. Включите опции в секции 'Privileged Gateway Intents':
   - ✅ PRESENCE INTENT
   - ✅ SERVER MEMBERS INTENT
   - ✅ MESSAGE CONTENT INTENT
5. Сохраните изменения

## Запуск бота

```powershell
python app.py
```

## Команды бота

Все команды работают как слеш-команды (/command) и доступны только администраторам сервера:

### Настройка каналов
- `/set-dismissal-channel #канал` - установить канал для рапортов на увольнение
- `/set-audit-channel #канал` - установить канал для кадрового аудита
- `/set-blacklist-channel #канал` - установить канал для чёрного списка
- `/show-channels` - показать все настроенные каналы

### Управление кнопками
- `/recreate-dismissal-button` - пересоздать кнопку для рапортов на увольнение
- `/recreate-audit-button` - пересоздать кнопку для кадрового аудита
- `/recreate-blacklist-button` - пересоздать кнопку для чёрного списка
- `/recreate-all-buttons` - пересоздать все кнопки во всех каналах

## Особенности

### Валидация данных
- Статик должен быть в формате 123-456 (3 цифры, тире, 3 цифры)
- Все поля имеют ограничения по длине
- Проверка корректности введённых данных

### Persistent Views
- Кнопки сохраняются после перезапуска бота
- Автоматическое восстановление кнопок при старте
- Проверка существования сообщений с кнопками

### Безопасность
- Все ответы на команды настройки видны только администратору (ephemeral)
- Доступ к командам только у пользователей с правами администратора
- Обработка ошибок и валидация входных данных

### Модульная архитектура
- Система Cogs для легкого расширения функциональности
- Отдельные модули для форм и утилит
- Простота добавления новых функций

## Хранение данных

Бот сохраняет информацию о настроенных каналах в файл `data/config.json`, который создается автоматически при первом запуске. Это обеспечивает сохранение настроек даже после перезапуска бота.

Пример структуры config.json:
```json
{
    "dismissal_channel": 123456789012345678,
    "audit_channel": 123456789012345679,
    "blacklist_channel": 123456789012345680
}
```

## Устранение неполадок

### Ошибка при запуске
- Убедитесь, что установлены все зависимости: `pip install -r requirements.txt`
- Проверьте правильность токена бота
- Убедитесь, что включены привилегированные интенты

### Команды не работают
- Проверьте права администратора у пользователя
- Убедитесь, что бот имеет права на отправку сообщений
- Проверьте синхронизацию команд (выполняется автоматически при старте)

### Кнопки не отвечают
- Используйте команду `/recreate-all-buttons` для пересоздания
- Проверьте права бота в каналах
- Убедитесь, что каналы настроены командами `/set-*-channel`

## Добавление новых функций

Для добавления новой функциональности:

1. Создайте новый .py файл в директории `cogs/` с классом, наследующим от `commands.Cog`
2. Добавьте новые формы в директорию `forms/`
3. Обновите `app.py` если нужны persistent views
4. Перезапустите бота - новые модули загрузятся автоматически

## Лицензия

Этот проект создан для внутреннего использования в организации.
