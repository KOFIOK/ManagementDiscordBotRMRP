#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Google –¢–∞–±–ª–∏—Ü–∞–º–∏
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É Google Sheets –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞
"""

import asyncio
import sys
import os
from utils.google_sheets import sheets_manager

async def test_google_sheets():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Google –¢–∞–±–ª–∏—Ü–∞–º –∏ –±–∞–∑–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏."""
    print("üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Google –¢–∞–±–ª–∏—Ü–∞–º–∏...")
      # –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    print("\n1Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...")
    success = sheets_manager.initialize()
    
    if not success:
        print("‚ùå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Google –¢–∞–±–ª–∏—Ü –Ω–µ —É–¥–∞–ª–∞—Å—å!")
        print("\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:")
        print("1. –§–∞–π–ª credentials.json —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω")
        print("2. –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ")
        print("3. ID —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π")
        return False
    
    print("‚úÖ Google –¢–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã!")
    
    # –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—Å—Ç—É
    print("\n2Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–∏—Å—Ç—É...")
    if sheets_manager.worksheet:
        print(f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω –∫ –ª–∏—Å—Ç—É: {sheets_manager.worksheet.title}")
        
        # –ü–æ–ª—É—á–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª–∏—Å—Ç–µ
        try:
            row_count = sheets_manager.worksheet.row_count
            col_count = sheets_manager.worksheet.col_count
            print(f"üìä –†–∞–∑–º–µ—Ä –ª–∏—Å—Ç–∞: {row_count} —Å—Ç—Ä–æ–∫ x {col_count} —Å—Ç–æ–ª–±—Ü–æ–≤")
            
            # –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
            headers = sheets_manager.worksheet.row_values(1)
            print(f"üìã –ù–∞–π–¥–µ–Ω–æ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: {len(headers)} —Å—Ç–æ–ª–±—Ü–æ–≤")
            for i, header in enumerate(headers[:5], 1):  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 5 –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
                print(f"   –°—Ç–æ–ª–±–µ—Ü {i}: {header}")
            
        except Exception as e:
            print(f"‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ª–∏—Å—Ç–∞: {e}")
    else:
        print("‚ùå –õ–∏—Å—Ç –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω!")
        return False
    
    print("\n‚úÖ –¢–µ—Å—Ç Google –¢–∞–±–ª–∏—Ü –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
    print("üöÄ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google –¢–∞–±–ª–∏—Ü.")
    return True

async def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    print("ü§ñ Army Discord Bot - –¢–µ—Å—Ç Google –¢–∞–±–ª–∏—Ü")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    if not os.path.exists('credentials.json') and not os.getenv('GOOGLE_CREDENTIALS_JSON'):
        print("‚ùå –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ Google –Ω–µ –Ω–∞–π–¥–µ–Ω—ã!")
        print("\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞:")
        print("1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª credentials.json –≤ –ø–∞–ø–∫—É –±–æ—Ç–∞, –ò–õ–ò")
        print("2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è GOOGLE_CREDENTIALS_JSON")
        print("\n–°–º. google_sheets_setup.md –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.")
        return
    
    success = await test_google_sheets()
    
    if success:
        print("\nüéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã! –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google –¢–∞–±–ª–∏—Ü–∞–º–∏ –≥–æ—Ç–æ–≤–∞.")
    else:
        print("\nüí• –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é.")

if __name__ == "__main__":
    try:
        asyncio.run(main())
    except KeyboardInterrupt:
        print("\n\n‚ö†Ô∏è –¢–µ—Å—Ç –ø—Ä–µ—Ä–≤–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º")
    except Exception as e:
        print(f"\nüí• –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π: {e}")
    
    input("\n–ù–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –≤—ã—Ö–æ–¥–∞...")
