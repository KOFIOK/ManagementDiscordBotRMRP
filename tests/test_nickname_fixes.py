#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ nickname_manager –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
"""

import sys
import os
import asyncio

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from utils.nickname_manager import NicknameManager

def test_parse_nickname():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–∞—Ä—Å–∏–Ω–≥ –Ω–∏–∫–Ω–µ–π–º–∞"""
    manager = NicknameManager()
    
    test_cases = [
        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å —Ä–∞–Ω–≥–∞–º–∏
        "DM | –ú–∞—Ä–∫–æ –¢—É–∞–ª–µ—Ç—Ç–æ",
        "–£–í–ü | –ú–ª. –°-—Ç | –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤", 
        "–í–ê | –†—è–¥–æ–≤–æ–π | –ê. –°–∏–¥–æ—Ä–æ–≤",
        
        # –î–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏
        "[–ö–æ–º–∞–Ω–¥–∏—Ä] –ò.–ò–≤–∞–Ω–æ–≤",
        "[–ù–∞—á. –®—Ç–∞–±–∞] –ê.–¢–∏–º–æ–Ω–æ–≤",
        "[–ö–æ–º. –ë—Ä–∏–≥] –í.–ó–∞–¥–æ—Ä–æ–∂–Ω—ã–π",
        
        # –î–æ–ª–∂–Ω–æ—Å—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –≤–∏–¥–µ (–¥–æ–ª–∂–Ω–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ —Ä–∞–Ω–≥–∞)
        "–í–ö | –ó–∞–º. –ù–∞—á. –ø–æ –ö–† | –í. –ö–∞—Ä–ø–æ–≤",
        "–£–í–ü | –ù–∞—á. –û—Ç–¥–µ–ª–∞ | –ò. –ü–µ—Ç—Ä–æ–≤",
        "–ì–® | –ö–æ–º. –ë—Ä–∏–≥ | –ê. –°–∏–¥–æ—Ä–æ–≤",
        "–ú–† | –ó–∞–º. –ù–∞—á. | –ü–µ—Ç—Ä –ò–≤–∞–Ω–æ–≤",
        
        # –û—Å–æ–±—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã - –ø—Ä–æ—Å—Ç—ã–µ
        "! –í–ª–∞–¥ –ó–∞–¥–æ—Ä–æ–∂–Ω—ã–π",
        "! –ò–º—è –ò–≤–∞–Ω–æ–≤",
        "!   –ü–µ—Ç—Ä   –°–∏–¥–æ—Ä–æ–≤",
        
        # –û—Å–æ–±—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã - —Å–ª–æ–∂–Ω—ã–µ
        "!![–ö–æ–º–∏—Å—Å–∞—Ä] –ò–º—è –ò–≤–∞–Ω–æ–≤",
        "![–ù–∞—á. –®—Ç–∞–±–∞] –ê.–¢–∏–º–æ–Ω–æ–≤", 
        "!![–ö–æ–º. –ë—Ä–∏–≥] –í.–ó–∞–¥–æ—Ä–æ–∂–Ω—ã–π",
        "!!![–ì–µ–Ω–µ—Ä–∞–ª] –ú–∞–∫—Å–∏–º –ì—Ä–æ–º–æ–≤",
        
        # –ü—Ä–æ—Å—Ç—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
        "–ü—Ä–æ—Å—Ç–æ–µ –ò–º—è",
        "–ê. –°–∏–¥–æ—Ä–æ–≤",
        "–û—á–µ–Ω—å –î–ª–∏–Ω–Ω–æ–µ –ò–º—è",
        
        # –£–≤–æ–ª–µ–Ω–Ω—ã–µ
        "–£–≤–æ–ª–µ–Ω | –ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤",
        "–£–≤–æ–ª–µ–Ω | –ò. –ò–≤–∞–Ω–æ–≤"
    ]
    
    print("üîç –¢–ï–°–¢ –ü–ê–†–°–ò–ù–ì–ê –ù–ò–ö–ù–ï–ô–ú–û–í:")
    print("=" * 50)
    
    for nickname in test_cases:
        parsed = manager.parse_nickname(nickname)
        print(f"–ù–∏–∫–Ω–µ–π–º: '{nickname}'")
        print(f"  üìã –§–æ—Ä–º–∞—Ç: {parsed['format_type']}")
        print(f"  üè¢ –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: {parsed['subdivision']}")
        print(f"  üéñÔ∏è –†–∞–Ω–≥: {parsed['rank']}")
        print(f"  üë§ –ò–º—è: {parsed['name']}")
        print(f"  üîí –û—Å–æ–±—ã–π: {parsed['is_special']}")
        print()

def test_extract_name_parts():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ —Ñ–∞–º–∏–ª–∏–∏"""
    manager = NicknameManager()
    
    test_names = [
        "–ú–∞—Ä–∫–æ –¢—É–∞–ª–µ—Ç—Ç–æ",
        "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
        "–ê. –°–∏–¥–æ—Ä–æ–≤",
        "–ò.–ò–≤–∞–Ω–æ–≤",
        "–ò–º—è –ò–≤–∞–Ω–æ–≤",
        "–ò–º—è –ò–≤–∞–Ω–æ–≤",
        "–ü—Ä–æ—Å—Ç–æ–µ –ò–º—è",
        "–û—á–µ–Ω—å –î–ª–∏–Ω–Ω–æ–µ –°–æ—Å—Ç–∞–≤–Ω–æ–µ –ò–º—è"
    ]
    
    print("üîç –¢–ï–°–¢ –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø –ò–ú–ï–ù:")
    print("=" * 50)
    
    for name in test_names:
        first_name, last_name = manager.extract_name_parts(name)
        print(f"–ü–æ–ª–Ω–æ–µ –∏–º—è: '{name}'")
        print(f"  üë§ –ò–º—è: '{first_name}'")
        print(f"  üë• –§–∞–º–∏–ª–∏—è: '{last_name}'")
        print()

def test_build_nickname():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –Ω–∏–∫–Ω–µ–π–º–∞"""
    manager = NicknameManager()
    
    test_cases = [
        ("–í–ê", "–ú–ª. –õ-—Ç", "–ú–∞—Ä–∫–æ", "–¢—É–∞–ª–µ—Ç—Ç–æ"),
        ("–£–í–ü", "–ú–ª. –°-—Ç", "–ú–∞—Ä–∫–æ", "–¢—É–∞–ª–µ—Ç—Ç–æ"),
        ("DM", "", "–ò–≤–∞–Ω", "–ü–µ—Ç—Ä–æ–≤"),
        ("", "–†—è–¥–æ–≤–æ–π", "–ü–µ—Ç—Ä", "–°–∏–¥–æ—Ä–æ–≤"),
        ("–£–í–ü", "–û—á–µ–Ω—å –î–ª–∏–Ω–Ω—ã–π –†–∞–Ω–≥", "–û—á–µ–Ω—å", "–î–ª–∏–Ω–Ω–∞—è –§–∞–º–∏–ª–∏—è")
    ]
    
    print("üîç –¢–ï–°–¢ –ü–û–°–¢–†–û–ï–ù–ò–Ø –ù–ò–ö–ù–ï–ô–ú–û–í:")
    print("=" * 50)
    
    for subdivision, rank, first_name, last_name in test_cases:
        nickname = manager.build_service_nickname(subdivision, rank, first_name, last_name)
        print(f"–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
        print(f"  üè¢ –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ: '{subdivision}'")
        print(f"  üéñÔ∏è –†–∞–Ω–≥: '{rank}'")
        print(f"  üë§ –ò–º—è: '{first_name} {last_name}'")
        print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç: '{nickname}' (–¥–ª–∏–Ω–∞: {len(nickname)})")
        print()

def test_preview_nickname_change():
    """–¢–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä"""
    manager = NicknameManager()
    
    current_nickname = "DM | –ú–∞—Ä–∫–æ –¢—É–∞–ª–µ—Ç—Ç–æ"
    
    print("üîç –¢–ï–°–¢ –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ì–û –ü–†–û–°–ú–û–¢–†–ê:")
    print("=" * 50)
    print(f"–¢–µ–∫—É—â–∏–π –Ω–∏–∫–Ω–µ–π–º: '{current_nickname}'")
    print()
    
    # –¢–µ—Å—Ç –ø–æ–≤—ã—à–µ–Ω–∏—è
    preview = manager.preview_nickname_change(
        current_nickname, 
        'promotion',
        rank_abbr='–ú–ª. –õ-—Ç'
    )
    print(f"–ü–æ–≤—ã—à–µ–Ω–∏–µ –¥–æ '–ú–ª. –õ-—Ç': '{preview}'")
    
    # –¢–µ—Å—Ç —É–≤–æ–ª—å–Ω–µ–Ω–∏—è
    preview = manager.preview_nickname_change(
        current_nickname,
        'dismissal'
    )
    print(f"–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ: '{preview}'")
    print()

if __name__ == "__main__":
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï NICKNAME_MANAGER")
    print("=" * 60)
    print()
    
    test_parse_nickname()
    test_extract_name_parts()
    test_build_nickname()
    test_preview_nickname_change()
    
    print("‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")