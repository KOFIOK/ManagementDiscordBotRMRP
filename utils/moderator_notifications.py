"""
–°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –≤—Å–µ—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
"""
import discord
from utils.config_manager import load_config


async def send_moderator_welcome_dm(user: discord.Member) -> bool:
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É –≤ –õ–°"""
    try:
        embed = discord.Embed(
            title="üéñÔ∏è –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤!",
            description="–í—ã –±—ã–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã **–º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º** –≤ —Å–∏—Å—Ç–µ–º–µ –∫–∞–¥—Ä–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –í–° –†–§",
            color=discord.Color.blue(),
            timestamp=discord.utils.utcnow()
        )
        
        embed.add_field(
            name="üõ°Ô∏è –í–∞—à–∏ –ø—Ä–∞–≤–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:",
            value=(
                "‚Ä¢ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ** - –∫–Ω–æ–ø–∫–∏ `‚úÖ –û–¥–æ–±—Ä–∏—Ç—å` / `‚ùå –û—Ç–∫–∞–∑–∞—Ç—å`\n"
                "‚Ä¢ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π** - –º–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ —Ä—è–¥–æ–≤—ã—Ö (–¥–ª—è –≤–æ–µ–Ω–Ω–æ–≥–æ –∫–æ–º–∏—Å—Å–∞—Ä–∏–∞—Ç–∞)\n"
                "‚Ä¢ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–∫–ª–∞–¥–∞** - –≤—ã–¥–∞—á–∞ —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ –∏–º—É—â–µ—Å—Ç–≤–∞ (–æ—Ç –ú–∞–π–æ—Ä–∞ –∏ –≤—ã—à–µ)\n"
                "‚Ä¢ **–ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è** - –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–∞–π–æ—Ä —Å–º–æ–∂–µ—Ç —É–≤–æ–ª–∏—Ç—å –∫–∞–ø–∏—Ç–∞–Ω–∞\n"
                "‚Ä¢ **–ö–∞–¥—Ä–æ–≤—ã–π –∞—É–¥–∏—Ç** - –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–µ —É—á—ë—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∞"
            ),
            inline=False
        )
        
        embed.add_field(
            name="‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:",
            value=(
                "‚Ä¢ –í—ã **–ù–ï –º–æ–∂–µ—Ç–µ** –æ–¥–æ–±—Ä–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞–ø–æ—Ä—Ç—ã\n"
                "‚Ä¢ –í—ã **–ù–ï –º–æ–∂–µ—Ç–µ** –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–≤–Ω–æ–≥–æ/–≤—ã—Å—à–µ–≥–æ —É—Ä–æ–≤–Ω—è\n"
            ),
            inline=False
        )
          # –ü–æ–ª—É—á–∞–µ–º –∫–∞–Ω–∞–ª –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
        config = load_config()
        registration_channel_id = config.get('moderator_registration_channel')
        registration_channel_mention = f"<#{registration_channel_id}>" if registration_channel_id else "–∫–∞–Ω–∞–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏"
        
        embed.add_field(
            name="üìã –ö–∞–∫ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É:",
            value=(
            f"1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ** - –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –∑–∞—è–≤–∫–∏ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç —Ñ–æ—Ä–º—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - {registration_channel_mention}\n"
            f"2. **–ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –≤–∞—à–∏ –§–ò–û –∏ —Å—Ç–∞—Ç–∏–∫ –±—É–¥—É—Ç –∏–∑–≤–ª–µ—á–µ–Ω—ã –∏–∑ –Ω–∏–∫–Ω–µ–π–º–∞ Discord\n"
            f"3. **–î–æ—Å—Ç—É–ø –∫ Google Sheets** - –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∞–≤–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ —Ç–∞–±–ª–∏—Ü\n"
            f"4. **–ù–∞—á–Ω–∏—Ç–µ –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å** - –≤—Å–µ –∑–∞—è–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ"
            ),
            inline=False
        )
        
        embed.add_field(
            name="‚ùì –£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ",
            value=(
            f" - –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/help` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏\n"
            ),
            inline=False
        )
        
        embed.set_footer(text="üí° –°–∏—Å—Ç–µ–º–∞ –∫–∞–¥—Ä–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –í–° –†–§ | –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è")
        embed.set_thumbnail(url=user.avatar.url if user.avatar else user.default_avatar.url)
        
        await user.send(embed=embed)
        return True
        
    except discord.Forbidden:
        print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å DM –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É {user.display_name} - –∑–∞–∫—Ä—ã—Ç—ã –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
        return False
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ DM –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—É {user.display_name}: {e}")
        return False


async def send_administrator_welcome_dm(user: discord.Member) -> bool:
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –≤ –õ–°"""
    try:
        embed = discord.Embed(
            title="üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥—É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤!",
            description="–í—ã –±—ã–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã **–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º** –≤ —Å–∏—Å—Ç–µ–º–µ –∫–∞–¥—Ä–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –í–° –†–§",
            color=discord.Color.gold(),
            timestamp=discord.utils.utcnow()
        )
        
        embed.add_field(
            name="üîë –í–∞—à–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞:",
            value=(
                "‚Ä¢ **–í—Å–µ –ø—Ä–∞–≤–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞** - –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞—è–≤–æ–∫\n"
                "‚Ä¢ **–ö–æ–º–∞–Ω–¥–∞ `/settings`** - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã\n"
                "‚Ä¢ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏** - –∫–æ–º–∞–Ω–¥—ã `/moder add/remove/list`\n"
                "‚Ä¢ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏** - –∫–æ–º–∞–Ω–¥—ã `/admin add/remove/list`\n"
                "‚Ä¢ **–û–¥–æ–±—Ä–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞—è–≤–æ–∫** - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è\n"
                "‚Ä¢ **–í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å –∏–µ—Ä–∞—Ä—Ö–∏–∏** - –º–æ–∂–µ—Ç–µ –º–æ–¥–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"
            ),
            inline=False
        )
        
        embed.add_field(
            name="‚öôÔ∏è –î–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:",
            value=(
                "‚Ä¢ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–æ–≤** - —É–≤–æ–ª—å–Ω–µ–Ω–∏—è, –∞—É–¥–∏—Ç, —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫, —Ä–æ–ª–∏, –º–µ–¥–∏—Ü–∏–Ω–∞, —Å–∫–ª–∞–¥\n"
                "‚Ä¢ **–°–∏—Å—Ç–µ–º–∞ –ø–∏–Ω–≥–æ–≤** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è–º\n"
                "‚Ä¢ **–†–æ–ª–∏-–∏—Å–∫–ª—é—á–µ–Ω–∏—è** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏, –Ω–µ —Å–Ω–∏–º–∞–µ–º—ã–º–∏ –ø—Ä–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏\n"
                "‚Ä¢ **–õ–∏–º–∏—Ç—ã —Å–∫–ª–∞–¥–∞** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º –∏ –∑–≤–∞–Ω–∏—è–º\n"
                "‚Ä¢ **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
            ),
            inline=False
        )
        
        embed.add_field(
            name="‚ùì –£–∑–Ω–∞–π—Ç–µ –±–æ–ª—å—à–µ",
            value=(
            f" - –í–≤–µ–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É `/help` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø—Ä–∞–≤–∫–∏\n"
            ),
            inline=False
        )
        
        embed.set_footer(text="üîê –°–∏—Å—Ç–µ–º–∞ –∫–∞–¥—Ä–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –í–° –†–§ | –í—ã—Å—à–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞")
        embed.set_thumbnail(url=user.avatar.url if user.avatar else user.default_avatar.url)
        
        await user.send(embed=embed)
        return True
        
    except discord.Forbidden:
        print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å DM –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É {user.display_name} - –∑–∞–∫—Ä—ã—Ç—ã –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è")
        return False
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ DM –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É {user.display_name}: {e}")
        return False


async def send_notification_to_channel(guild: discord.Guild, user: discord.Member, role_type: str) -> bool:
    """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ (–û–¢–ö–õ–Æ–ß–ï–ù–û)"""
    # –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª –Ω–µ –Ω—É–∂–Ω—ã
    print(f"üîï –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª –æ—Ç–∫–ª—é—á–µ–Ω–æ –¥–ª—è {role_type} {user.display_name}")
    return True  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º True, —á—Ç–æ–±—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤ –ª–æ–≥–∞—Ö


def check_if_user_is_moderator(user: discord.Member, config: dict) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º"""
    # –í–ª–∞–¥–µ–ª–µ—Ü —Å–µ—Ä–≤–µ—Ä–∞ –∏ Discord –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏, –Ω–µ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞–º–∏
    if user.guild.owner_id == user.id or user.guild_permissions.administrator:
        return False
    
    moderators = config.get('moderators', {'users': [], 'roles': []})
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä—è–º–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user.id in moderators.get('users', []):
        return True
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ —Ä–æ–ª–∏
    moderator_role_ids = moderators.get('roles', [])
    user_role_ids = [role.id for role in user.roles]
    
    for role_id in moderator_role_ids:
        if role_id in user_role_ids:
            return True
    
    return False


def check_if_user_is_administrator(user: discord.Member, config: dict) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"""
    # –í–ª–∞–¥–µ–ª–µ—Ü —Å–µ—Ä–≤–µ—Ä–∞ –∏ Discord –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
    if user.guild.owner_id == user.id or user.guild_permissions.administrator:
        return True
    
    administrators = config.get('administrators', {'users': [], 'roles': []})
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä—è–º–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if user.id in administrators.get('users', []):
        return True
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—Å–∫–∏–µ —Ä–æ–ª–∏
    admin_role_ids = administrators.get('roles', [])
    user_role_ids = [role.id for role in user.roles]
    
    for role_id in admin_role_ids:
        if role_id in user_role_ids:
            return True
    
    return False
